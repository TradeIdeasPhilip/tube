@import url("https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Ranchers&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Life+Savers:wght@400;700;800&display=swap");

body {
  font-family: "Life Savers", serif;
  font-weight: bold;
  font-size: 1.4em;
}

select,
input {
  font-family: "Life Savers", serif;
  font-weight: bold;
  font-size: 90%;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: "Ranchers", fantasy;
  font-weight: 400;
}

/**
 * This is a common style for code.
 *
 */
code {
  background-color: lightblue;
  border-radius: 0.3em;
  padding-left: 0.25em;
  padding-right: 0.25em;
  color: blue;
  font-family: "Source Code Pro", monospace;
  font-weight: 400;
  font-size: 85%;
}

a:visited {
  color: #c000c0;
}

/* -------------------------------------------------
   CSS variables that can be animated
   ------------------------------------------------- */
@property --rotation {
  syntax: "<angle>";
  inherits: false;
  initial-value: 0turn;
}
@property --x-offset {
  syntax: "<length>";
  inherits: true;
  initial-value: 0;
}
@property --y-offset {
  syntax: "<length>";
  inherits: true;
  initial-value: 0;
}

/* -------------------------------------------------
   Container – only the perspective stays here
   ------------------------------------------------- */
#container1 {
  perspective: 224px;
  position: absolute;
  transform-style: preserve-3d;
  top: 50vh;
  left: 50vw;
  perspective-origin: 0 0;

  --y-scale: 1;
  --height: 400px;
  --z-offset: 0px;
  --cone: 0deg;
}

[data-segment="0"] {
  --y-scale: 1;
  --height: 301px;
  --z-offset: 0px;
}

[data-segment="1"] {
  --y-scale: 5;
  --height: 1501px;
  --z-offset: 300px;
}

[data-segment="2"] {
  --y-scale: 20;
  --height: 6001px;
  --z-offset: 1800px;
  --cone: 5deg;
}

[data-segment="3"] {
  --y-scale: 25;
  --height: 6001px;
  --z-offset: 7800px;
}

/* -------------------------------------------------
   One side of a tube segment
   ------------------------------------------------- */
.tube-side {
  /* ---- layout ------------------------------------------------ */
  color: white;
  background-color: black;
  text-align: center;
  position: absolute;
  width: calc(1px + var(--width)); /* unchanged */
  left: calc(var(--width) / -2);
  transform-origin: center top;

  /* ---- height in *unscaled* units ----------------------------- */
  /* TS will set --height (real world length, e.g. 200vmin) */
  height: calc(var(--height) / var(--y-scale));

  /* ---- 3-D transform ------------------------------------------ */
  /* 1. [gone] */
  /* 2. rotate around the tube axis */
  /* 3. push the top of the panel to the tube radius */
  /* 4. lay the panel flat on the inside wall */
  /* 5. offset the whole segment down the tube */
  /* 6. stretch it vertically (LOD) */
  transform: rotateZ(var(--rotation)) translateY(-50vmin) rotateX(-90deg)
    translateY(var(--z-offset)) rotateX(var(--cone)) scaleY(var(--y-scale));

  /* ---- GPU promotion ------------------------------------------ */
  backface-visibility: hidden;

  white-space: pre-line;

  /* ---- repeating texture -------------------------------------- */
  background-image: url("./hex.svg?url");

  /* the texture size is *unscaled* – we divide by the scale factor */
  --bg-w: calc(var(--width) * var(--number-of-sides) / 7);
  --bg-h: calc(var(--bg-w) / sqrt(3));
  background-size: var(--bg-w) calc(var(--bg-h) / var(--y-scale));

  /* horizontal offset for seamless wrap across sides */
  background-position-x: calc(var(--x-offset) - var(--n) * var(--width));
  background-position-y: calc(
    var(--y-offset) - (var(--z-offset) / var(--y-scale))
  );

  /* ---- animation (same logic, now aware of scale) ------------- */
  animation: background-opt 20s linear 0s infinite;
}

/* -------------------------------------------------
   Seamless scrolling animation
   ------------------------------------------------- */
@keyframes background-opt {
  0% {
    --x-offset: 0;
    --y-offset: 0;
  }
  90% {
    --x-offset: 0;
    --y-offset: calc(-9 * var(--bg-h) / var(--y-scale));
  }
  100% {
    --x-offset: var(--bg-w);
    --y-offset: calc(-10 * var(--bg-h) / var(--y-scale));
  }
}
